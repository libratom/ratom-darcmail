<!--# 
This template represents the EAXS ??? element.
It is related to the lib.??? module.

TODO:
    * Remove fake attributes: @att, etc. from MultiBody; remove test lines.
    * Add in child elements of opening MultiBody tags.
#-->

{% set OPENED_MULTIBODIES = [] %}

<!--# ??? #-->
{% for msg in message.get_submessages() %}

    {% for open_multibody in EAXSHelpers.close_folders(msg, OPENED_MULTIBODIES, "mock_path") %}
</MultiBody>
    {% endfor %}

    <!--# Add in <MultiBody> child elements. #-->
    {% if msg.is_multipart() %}
<MultiBody att="{{ msg.mock_path |normalize_path }}">
    {% else %}
    <SBody att="{{ msg.mock_path |normalize_path }}" />
    <!--# {% include "SingleBody.xml" %} #-->
    <!--# Because this is a SingleBody element, remove it from @OPENED_MULTIBODIES so that we don't
    end up with an stray closing MultiBody tags. #-->
    {% if OPENED_MULTIBODIES.pop() %}{% endif %}
    {% endif %}

{% endfor %}

{% for msg in OPENED_MULTIBODIES |reverse %}
</MultiBody>
{% endfor %}