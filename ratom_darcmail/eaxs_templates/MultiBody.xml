<!--# 
This template represents the EAXS ??? element.
It is related to the lib.??? module.

TODO:
    * Remove fake attributes: @att, etc. from MultiBody; remove test lines.
    * Add in child elements of opening MultiBody tags.
#-->

{% set OPENED_MULTIBODIES = [] %}

<!--# ??? #-->
{% for msg in message.get_submessages() %}

{% for open_multibody in EAXSHelpers.close_folders(msg, OPENED_MULTIBODIES, "mock_path") %}
</MultiBody>
{% endfor %}

<!--# Add in <MultiBody> child elements. #-->
{% if msg.is_multipart() %}
<MultiBody>
{% filter indent(width=4, first=True) %}
    {% include "xm-body-type.xml" %}
{% endfilter %}
    <!--<Preamble></Preamble>--> <!--# TODO: fill in; move this to xm-body-type.xml #-->
{% else %}
    {% filter indent(width=4, first=True) %}
        {% include "SingleBody.xml" %}
    {% endfilter %}
    <!--# Because this is a SingleBody element, remove it from @OPENED_MULTIBODIES so that we don't
    end up with an stray closing MultiBody tags. #-->
    {% if OPENED_MULTIBODIES.pop() %}{% endif %}
{% endif %}
<!--<Epilogue></Epilogue>-->  <!--# TODO: fill in; this isn't in the write place. 
    I think when you're closing MultiBody you'll need to: 
    for open_multibody in OPENED_MULTIBODIES:
        <Epilogue>{{ get epilogue from open_multibody }}<Epilogue></Epilogue>
        </MultiBody>
    ps: Looked like msg.preamble|epilogue can return None or an empty string. So skip the element
    if None, otherwise create the element with no value.
    #-->
{% endfor %}

{% for open_multibody in OPENED_MULTIBODIES |reverse %}
</MultiBody>
{% endfor %}