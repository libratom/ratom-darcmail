<!--# 
TODO:
    * Make sure you use skipnull and cdata wherever needed.
    * Check all elements against schema for what elements are repeatable and make sure you are
    supporting that.
    * Need to store messages in "/messages" with ".message" extenstion VS attachments:
        "/attachments/*.attachment".
#-->


<SingleBody>
    
    {% filter indent(width=4, first=True) %}
        {% include "xm-body-type.xml" %}
    {% endfilter %}

    <!--# TODO: Implement ExtBodyContent option for messages? #-->
    {% if None is not defined %}
    <BodyContent>
    <!--#Content><![CDATA[{% for part in msg.walk() %}{{ part |escape_cdata }}{% endfor %}]]></Content#-->
        <!--# TODO: Work on this. Needs to be printable? #-->
        <Content>{{ msg.as_string() |cdata }}</Content>
        <TransferEncoding>{{ DarcMail.charset.lower() }}</TransferEncoding>
    </BodyContent>
    {% else %}
    <!--# TODO: work on ext_path, LocalId, EOL, etc. ... #-->
    <ExtBodyContent>
        {% set ext_file = EAXSHelpers.write_message(msg) %}
        <RelPath>{{ ext_path }}</RelPath>
        <CharSet>{{ msg.get_content_charset() |skipnull }}</CharSet>
        <TransferEncoding>{{ msg.get("content-transfer-encoding") }}</TransferEncoding>
        <LocalId>{{ msg.account.current_id }}</LocalId>
        <XMLWrapped>false</XMLWrapped>
        <Eol>{{ EAXSHelpers.get_eol(msg) }}</Eol>
        <!--# ??? Implement? <Hash></Hash> #-->
    </ExtBodyContent>

    <!--# Skip. EAXS XSD does not describe this well enough to implement.
        <ChildMessage></ChildMessage>
    #-->
    {% endif %}

<!--# Skip. EAXS XSD does not describe this well enough to implement.
TODO: I'm not sure about that: it's for "message/external-body" so research that before
giving up on this element.
    <PhantomBody></PhantomBody>
#-->

</SingleBody>
<!--# The "raw" block below forces a line break. #-->
{% raw %}{% endraw %}